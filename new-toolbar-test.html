<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Spreadsheet Name</title>
<script type="text/javascript" src="socialcalcconstants.js"></script>
<script type="text/javascript" src="socialcalc-3.js"></script>
<script type="text/javascript" src="socialcalctableeditor.js"></script>
<script type="text/javascript" src="formatnumber2.js"></script>
<script type="text/javascript" src="formula1.js"></script>
<script type="text/javascript" src="socialcalcpopup.js"></script>
<script type="text/javascript" src="toolbar.js"></script>
<script type="text/javascript" src="jquery-1.3.2.min.js"></script>
<link rel="stylesheet" type="text/css" href="socialcalc.css">
<link rel="stylesheet" href="styling.css" type="text/css" media="screen" title="no title" charset="utf-8" />
<script type="text/javascript" charset="utf-8" src="jquery-1.3.2.min.js">
</script>
<script type="text/javascript" charset="utf-8" src="jquery-ui.min.js">
</script>
<script type="text/javascript" charset="utf-8">
var accordions = {
edit: null,
format: null,
align: null,
insert: null,
move: null
}

closeItem = function(accordion){
$(accordion).removeClass('open').addClass('closed');
}

openItem = function(accordion){
$(accordion).removeClass('closed').addClass('open');
}

openToggle = function(ev) {
thisAccordian = $(ev.target).parent();
thisName = thisAccordian.attr('id').split('-')[0];
if (thisAccordian.hasClass('closed')) {
    thisAccordian.removeClass('closed').addClass('open');
}
$.each(accordions, function(key, accordion){
    name = accordion.attr('id').split('-')[0];
    if (thisName != name) {
        accordion.removeClass('open').addClass('closed');
    }
});
}

closeToggle = function(ev) {
}

$(document).ready(function() {
$.each(accordions, function(key, accordion){
    accordions[key] = $('#'+key);
    $('.toggler', accordion).toggle(openToggle, closeToggle);
});
});
    $(function(){
        $('#tabs').tabs();
    });
</script>
<style>
body
{font-family:verdana,helvetica,sans-serif;font-size:small;}
.testclass {border:2px dotted red;}
.testclass2 {background-image:url(images/sc-logo.gif);}
.smaller {font-size:smaller;}
.hide {display:none;}
</style>
</head>
<body onresize="doresize();">
<!--
[% IF UA_is_MacOSX %]
[% SET hotkey = 'Cmd' %]
[% ELSE %]
[% SET hotkey = 'Ctrl' %]
[% END %]
-->
<div id="socialcalc-controls">
<div id="socialcalc-header">
    <div id="buttons">
        <input id="st-save-button-link" type="button" name="save" value="Save" title="Save Changes" />
        <input id="st-cancel-button-link"  type="button" name="cancel" value="Cancel" title="Cancel Edit" />
        <input id="st-recalc-button-link" class="disabled" type="button" name="refresh" value="Refresh" title="Refresh Sheet" />
    </div>
    <h2 id="title">Spreadsheet Name</h2>
    <img src="images/expand.png" style="float:right;width:16px;height:16px;margin-right:4px;margin-top:4px" />
    <ul id="tabs">
        <li class="selected"><a id="st-edit-mode-button-link" href="#edit-toolbar">Edit</a></li>
        <li><a id="st-preview-mode-button-link" href="#preview-toolbar">Preview</a></li>
        <li><a id="st-revisions-mode-button-link" href="#revisions-toolbar">Revisions</a></li>
        <li><a id="st-audit-mode-button-link" href="#audit-toolbar">Audit</a></li>
    </ul>
</div>
<div id="edit-toolbar">
    <div class="accordion open" id="edit">
        <span class="toggler" id="edit-toggle">◀ Edit</span>
        <div id="editing-wrapper" class="wrapper">
            <div class="icon-action">
                <span class="icon-selector">
                    <img id="st-undo-button-link" src="images/undo.png" title="Undo" />
                    <img class="selector" src="images/selector.png" />
                </span>
                <img id="st-redo-button-link" src="images/redo.png" title="Redo"/>
                <img id="st-cut-button-link" src="images/cut.png" title="Cut (Press [% hotkey %]-X to cut to other applications)" />
                <img id="st-copy-button-link" src="images/copy.png" title="Copy (Press [% hotkey %]-C to copy to other applications)" />
                <img id="st-paste-button-link" src="images/paste.png" title="Paste (Press [% hotkey %]-V to paste from other applications)" />
                <img id="st-erase-button-link" src="images/erase.png" title="Erase" />
            </div>
        </div>
    </div>
    <div class="accordion closed" id="format">
        <span class="toggler" id="format-toggler">Format ▶</span>
        <div id="format-wrapper" class="wrapper">
            <div class="icon-set">
                <img id="st-bold-button-link" src="images/bold.png" title="Bold" />
                <img id="st-italic-button-link" src="images/italic.png" title="Italic" />
                <img id="st-underline-button-link" src="images/underline.png" title="Underline" />
                <img id="st-strikethrough-button-link" src="images/strikethrough.png" title="Strike Through" />
            </div>
            <div class="separator">&nbsp;</div>
            <div class="icon-set">
                <img id="st-color-button-link" src="images/font-color.png" title="Text Color" />
                <img id="st-bgcolor-button-link" src="images/bg-color.png" title="Background Color" />
                <img id="st-swapcolors-button-link" src="images/swap-colors.png" title="Swap foreground and background colors" />
                <img id="st-cell-borders-button-link" src="images/borders.png" title="Borders On/Off" />
            </div>
            <div class="separator">&nbsp;</div>
            <div class="form-set">
                <select id="st-spreadsheet-cell-font-family"><option>Arial</option><option>Georgia</option><option>Tahoma</option><option>Trebuchet MS</option><option>Courier</option></select>
                <select id="st-spreadsheet-cell-font-size"><option>9</option><option>10</option><option>12</option><option>15</option><option>21</option><option>28</option></select>
                <select id="st-spreadsheet-cell-number-format">
                    <option value="">Format</option>
                    <option value="0">1234</option>
                    <option value="#,##0">1,234</option>
                    <option value="#,##0.0">1,234.5</option>
                    <option value="#,##0.00">1,234.56</option>
                    <option value="#,##0.000">1,234.567</option>

                    <option value="#,##0%">1,234%</option>
                    <option value="#,##0.0%">1,234.5%</option>

                    <option value="#,##0_);(#,##0)">(1,234)</option>
                    <option value="#,##0.0_);(#,##0.0)">(1,234.5)</option>
                    <option value="#,##0.00_);(#,##0.00)">(1,234.56)</option>

                    <option value="00">00</option>
                    <option value="000">000</option>
                    <option value="0000">0000</option>

                    <option value="$#,##0.00">$1,234.56</option>
                    <option value="yyyy-mm-dd">2008-05-29</option>
                    <option value="hh:mm:ss">01:23:45</option>
                    <option value="yyyy-mm-dd hh:mm:ss">2008-05-29 01:23:45</option>

                    <option value="hidden">Hidden</option>
                </select>
            </div>
        </div>
    </div>
    <div class="accordion closed" id="align">
        <span class="toggler" id="align-toggle">Align ▶</span>
        <div id="align-wrapper" class="wrapper">
            <div class="icon-toggle">
                <img id="st-left-button-link" src="images/align-left.png" title="Left" />
                <img id="st-center-button-link" src="images/align-center.png" title="Center" />
                <img id="st-right-button-link" src="images/align-right.png" title="Right" />
                <img id="st-justify-button-link" src="images/align-just.png" title="Justify" />
            </div>
            <div class="separator">&nbsp;</div>
            <div class="icon-toggle">
                <img id="st-top-button-link" src="images/align-top.png" title="Top" />
                <img id="st-middle-button-link" src="images/align-middle.png" title="Middle" />
                <img id="st-bottom-button-link" src="images/align-bottom.png" title="Bottom" />
            </div>
        </div>
    </div>
    <div class="accordion closed" id="insert">
        <span class="toggler" id="insert-toggle">Insert ▶</span>
        <div id="insert-wrapper" class="wrapper">
            <div class="icon-set">
                <img id="st-insert-link-button-link" src="images/insert-link.png" title="Link" />
                <img id="st-insert-widget-button-link" src="images/insert-widget.png" title="Widget" />
                <img id="st-insert-image-button-link" src="images/insert-image.png" title="Image" />
                <img id="st-insert-formula-button-link" src="images/formula.png" title="Formula" />
                <img id="st-sum-range-button-link" src="images/sum.png" title="Sum" />
            </div>
        </div>
    </div>
    <div class="accordion closed" id="move"> 
        <span class="toggler" id="move-toggle">Move ▶</span>
        <div id="move-wrapper" class="wrapper">
            <div class="icon-set">
                <img id="st-filldown-button-link" src="images/fill-down.png" title="Fill Down" />
                <img id="st-fillright-button-link" src="images/fill-right.png" title="Fill Right" />
            </div>
            <div class="separator">&nbsp;</div>
            <div class="icon-set">
                <img id="st-movemark-button-link" src="images/mark.png" title="Mark/Clear Move Source" />
                <img id="st-movepaste-button-link" src="images/move-paste.png" title="Move Paste" />
                <img id="st-moveinsert-button-link" src="images/move-insert.png" title="Move Insert" />
            </div>
            <div class="separator">&nbsp;</div>
            <div class="icon-set">
                <img id="st-insert-row-button-link" src="images/insert-row.png" title="Insert Row" />
                <img id="st-insert-col-button-link" src="images/insert-column.png" title="Insert Column" />
                <img id="st-delete-row-button-link" src="images/delete-row.png" title="Delete Row" />
                <img id="st-delete-col-button-link" src="images/delete-column.png" title="Delete Column" />
                <img id="st-merge-button-link" src="images/merge.png" title="Merge Selected Cells" />
            </div>
        </div>
    </div>
</div>
<div id="st-spreadsheet-preview-toolbar" class="preview hidden"><br><br></div>
<div id="st-spreadsheet-revisions-toolbar" class="revisions hidden">
    <a class="previous" href="#">← </a>
    <input name="revision-number" />
    <a class="next" href="#">→</a>
    <br/>
    <span class="label">By:</span>
    <span class="author"></span>
    <br/>
    <span class="label">On:</span>
    <span class="time"></span>
</div>

<div id="st-spreadsheet-audit-toolbar" class="audit hidden"></div>

<div id="formula">
    <div class="icon-set">
        <img id="st-sum-range-button-link" src="images/sum.png" title="Sum Range" />
        <img id="st-formula-button-link" src="images/formula.png" title="Insert Formula" />
        <img id="st-name-button-link" src="images/names.png" title="Name Data" />
        <img id="st-comment-button-link" src="images/comment.png" title="Cell Comment" />
    </div>
    <div class="separator">&nbsp;</div>
    <div id="cell-detail-small-wrapper" class="open">
        <input id="cell-detail-small" type="text" name="cell-detail" value="" />
        <div class="icon-set">
            <img id="st-multiline-button-link" src="images/multi-line.png" title="Show multiple lines of input" />
        </div>
    </div>
    <div id="cell-detail-large-wrapper" class="hidden">
        <textarea id="cell-detail-large">
        </textarea>
        <div class="icon-set">
            <img id="st-oneline-button-link" src="images/one-line.png" title="Show one line of input" />
        </div>
    </div>
</div>
</div>

<form name="f0" action="" method="POST">
<!--
<div style="padding:6px;background-color:#80A9F3;">
<span style="font-weight:bold;color:white;">ssctrltest1.html</span>
<input type="button" name="savespreadsheet" value="Save" onclick="dosave();" class="smaller">
<input type="submit" name="newcolors" value="New Colors" onclick="document.f0.action='?4C808';" class="smaller">
<input class="hide" type="button" value="Recalc" onclick="spreadsheet.ExecuteCommand('recalc', '');" class="smaller">
<input class="hide" type="button" value="Redisplay" onclick="spreadsheet.editor.ScheduleRender();" class="smaller">
<input class="hide" type="button" value="Settings" onclick="alert(sv=spreadsheet.editor.SaveEditorSettings());" class="smaller">
<input type="button" value="Reload" onclick="doreload();" class="smaller">
<input class="hide" type="button" value="CellHTMLSave" onclick="alert(spreadsheet.CreateCellHTMLSave(null));" class="smaller">
<input class="hide" type="button" value="CellHTML A1" onclick="alert(spreadsheet.CreateCellHTML('A1'));" class="smaller">
<input class="hide" type="button" value="SheetHTML" onclick="alert(spreadsheet.CreateSheetHTML());" class="smaller">
<input class="hide" type="button" value="SheetSave" onclick="alert(spreadsheet.CreateSheetSave());" class="smaller">
<input class="hide" type="button" value="Attribs" onclick="doattribs();" class="smaller">
<input class="hide" type="button" value="New Copy" onclick="newcopy();" class="smaller">
<input type="button" value="Sum" onclick="dosum();" class="smaller">
<input type="button" value="Sum2" onclick="dosum2();" class="smaller">
-->
<textarea id="savestr" style="display:none;"></textarea>
<input type="hidden" name="newstr" id="newdata" value="">
<input type="hidden" name="pagename" value="$pagename">
<input type="hidden" name="sheetname" value="$sheetname">
<!--
</div>
-->
</form>
<div id="msg" style="position:absolute;right:15px;">
<input type="button" style="font-size:x-small;" value="Clear" onclick="addmsg('',true);"><br>
<textarea id="msgtext" style="margin-top:10px;width:110px;height:200px;"></textarea><br>
</div>
<div id="tableeditor" style="margin:8px 140px 10px 0px;">editor goes here</div>
<script>

document.getElementById("msgtext").value = "";

function setmsg(msg) {document.getElementById("msg").innerHTML = msg;}
function addmsg(msg, clear) {
   var msgtextid = document.getElementById("msgtext");
   if (!msgtextid) {
      document.getElementById("msg").innerHTML = '<textarea id="msgtext" cols="60" rows="5"></textarea>';
      msgtextid = document.getElementById("msgtext");
      }
   if (clear) msgtextid.value = "";
   if (msgtextid.value.length>0) msgtextid.value += "\n";
   msgtextid.value += msg;
   }

//
// Setup code starts here:
//

//   SocialCalc.ConstantsSetClasses("");

   var scc = SocialCalc.Constants;

   var b1 = window.location.search.charAt(1) || "4";
   var b2 = window.location.search.charAt(2) || "C";
   var b3 = window.location.search.charAt(3) || "8";
   var b4 = window.location.search.charAt(4) || "9";
   var b5 = window.location.search.charAt(5) || "8";

   scc.SCToolbarbackground = "background-color:#4040"+b1+"0;";
   scc.SCTabbackground = "background-color:#CC"+b2+";";
   scc.SCTabselectedCSS = "font-size:small;padding:6px 30px 6px 8px;color:#FFF;background-color:#4040"+b1+"0;cursor:default;border-right:1px solid #CC"+b2+";";
   scc.SCTabplainCSS = "font-size:small;padding:6px 30px 6px 8px;color:#FFF;background-color:#8080"+b3+"0;cursor:default;border-right:1px solid #CC"+b2+";";
   scc.SCToolbartext = "font-size:x-small;font-weight:bold;color:#FFF;padding-bottom:4px;";
   scc.ISCButtonBorderNormal = "#4040"+b1+"0";
   scc.ISCButtonBorderHover = "#99"+b4+"";
   scc.ISCButtonBorderDown = "#FFF";
   scc.ISCButtonDownBackground = "#88"+b5+"";

   var spreadsheet = new SocialCalc.SpreadsheetControl();
   var savestr = document.getElementById("savestr");

   spreadsheet.InitializeSpreadsheetControl("tableeditor", 0, 0, 0);
   spreadsheet.ExecuteCommand('redisplay', '');

   spreadsheet.ExportCallback = function(s) {
      alert(SocialCalc.ConvertSaveToOtherFormat(SocialCalc.Clipboard.clipboard, "csv"));
      }

// Dummy loadsheet for testing:
SocialCalc.Formula.SheetCache.LoadSheet = function(sheetname) {
   var sfscc = SocialCalc.Formula.SheetCache.constants;
   var doload = confirm("Loadsheet: "+sheetname+"?");
   if (true) {
      return {status: doload?sfscc.ok:sfscc.loading, str: "cell:A1:v:4\ncell:A2:t:Sheet\\c "+sheetname+"\ncell:A3:vtf:ndt:0:NOW()\ncell:B1:v:5\ncell:B2:v:6\nname:AONE::A1\nname:ATWO::A2\nname:RANGE::B1\\cB2\nname:TEST::A3",
              recalc: true};
      }
   return null;
   }

// ExpandWiki code for testing

SocialCalc.Callbacks.expand_wiki = function(displayvalue, sheetobj, linkstyle, valueformat) {

   var subtype = valueformat.substring(9); // stuff after text-wiki
   var result = "";

   switch (subtype) {
      case "":
         result = SocialCalc.default_expand_markup(displayvalue, sheetobj, linkstyle);
         break;

      case "-link":
         result = "link to: "+SocialCalc.special_chars(displayvalue);
         break;

      default:
         result = SocialCalc.special_chars(valueformat+": "+displayvalue);
         break;
      }

   return result || "&nbsp;";

   }

function dosave() {
   savestr.value = spreadsheet.CreateSpreadsheetSave();
   alert(savestr.value);
   }

function doreload() {

   var parts = spreadsheet.DecodeSpreadsheetSave(savestr.value);
   if (parts) {
      if (parts.sheet) {
         spreadsheet.sheet.ResetSheet();
         spreadsheet.ParseSheetSave(savestr.value.substring(parts.sheet.start, parts.sheet.end));
         }
      if (parts.edit) {
         spreadsheet.editor.LoadEditorSettings(savestr.value.substring(parts.edit.start, parts.edit.end));
         }
      }
   if (spreadsheet.editor.context.sheetobj.attribs.recalc=="off") {
      spreadsheet.ExecuteCommand('redisplay', '');
      }
   else {
      spreadsheet.ExecuteCommand('recalc', '');
      }
   }

function doresize() {
   spreadsheet.DoOnResize();
   }

function doattribs() {
   var attribs = spreadsheet.sheet.EncodeCellAttributes(spreadsheet.editor.ecell.coord);
   var str = "";
   for (var attrib in attribs) {
      str += attrib + ":" + " def="+attribs[attrib].def+", val='"+attribs[attrib].val+"'\n";
      }
   str+="=====\n";
   attribs = spreadsheet.sheet.EncodeSheetAttributes();
   for (var attrib in attribs) {
      str += attrib + ":" + " def="+attribs[attrib].def+", val='"+attribs[attrib].val+"'\n";
      }
   alert(str);
   }

var fromrange = "A1:A1";

function newcopy() {

   var ta, cell, position, sel, parseobj;

   var spreadsheet = SocialCalc.GetSpreadsheetControlObject();
   var editor = spreadsheet.editor;

   ta = editor.pasteTextarea;
   ta.value = "";

   cell=SocialCalc.GetEditorCellElement(editor, editor.ecell.row, editor.ecell.col);
   if (cell) {
      position = SocialCalc.GetElementPosition(cell.element);
      ta.style.left = (position.left-1)+"px";
      ta.style.top = (position.top-1)+"px";
      }
   if (editor.range.hasrange) {
      sel = SocialCalc.crToCoord(editor.range.left, editor.range.top)+
         ":"+SocialCalc.crToCoord(editor.range.right, editor.range.bottom);
      }
   else {
      sel = editor.ecell.coord;
      }

   parseobj = new SocialCalc.Parse("copy "+sel+" all");
   SocialCalc.ExecuteSheetCommand(editor.context.sheetobj, parseobj, true); // note: not queued!!!??!!
   SocialCalc.Clipboard.clipboard.loadedByCtrlC = true; // remember this clipboard data was from ctrl-c
   ta.value = SocialCalc.ConvertSaveToOtherFormat(SocialCalc.Clipboard.clipboard, "tab");
   ta.style.display = "block";
   ta.focus();
   ta.select();
//   var range = document.selection.createRange();
var range = window.getSelection().getRangeAt(0);

   range.execCommand("copy");
   window.setTimeout(function() {
      var s = SocialCalc.GetSpreadsheetControlObject();
      var editor = s.editor;
      var ta = editor.pasteTextarea;
      ta.style.display = "none";
      }, 200);
   return;
  }

function dosum() {

   var cmd, cell, row, col, sel, cr, foundvalue;

   var spreadsheet = SocialCalc.GetSpreadsheetControlObject();
   var editor = spreadsheet.editor;
   var sheet = editor.context.sheetobj;

   if (editor.range.hasrange) {
      sel = SocialCalc.crToCoord(editor.range.left, editor.range.top)+
         ":"+SocialCalc.crToCoord(editor.range.right, editor.range.bottom);
      cmd = "set "+SocialCalc.crToCoord(editor.range.right, editor.range.bottom+1)+
         " formula sum("+sel+")";
      }
   else {
      row = editor.ecell.row - 1;
      col = editor.ecell.col;
      if (row<=1) {
         cmd = "set "+editor.ecell.coord+" constant e#REF! 0 #REF!";
         }
      else {
         foundvalue = false;
         while (row>0) {
            cr = SocialCalc.crToCoord(col, row);
            cell = sheet.GetAssuredCell(cr);
            if (!cell.datatype || cell.datatype=="t") {
               if (foundvalue) {
                  row++;
                  break;
                  }
               }
            else {
               foundvalue = true;
               }
            row--;
            }
         cmd = "set "+editor.ecell.coord+" formula sum("+
            SocialCalc.crToCoord(col,row)+":"+SocialCalc.crToCoord(col, editor.ecell.row-1)+")";
         }
      }

   editor.EditorScheduleSheetCommands(cmd);

  }

function dosum2() {

   var cmd, cell, row, col, sel, cr, foundvalue;

   var spreadsheet = SocialCalc.GetSpreadsheetControlObject();
   var editor = spreadsheet.editor;
   var sheet = editor.context.sheetobj;

   if (editor.range.hasrange) {
      sel = SocialCalc.crToCoord(editor.range.left, editor.range.top)+
         ":"+SocialCalc.crToCoord(editor.range.right, editor.range.bottom);
      cmd = "sum("+sel+")";
      }
   else {
      row = editor.ecell.row - 1;
      col = editor.ecell.col;
      if (row<=1) {
         cmd = "sum()";
         }
      else {
         foundvalue = false;
         while (row>0) {
            cr = SocialCalc.crToCoord(col, row);
            cell = sheet.GetAssuredCell(cr);
            if (!cell.datatype || cell.datatype=="t") {
               if (foundvalue) {
                  row++;
                  break;
                  }
               }
            else {
               foundvalue = true;
               }
            row--;
            }
         cmd = "sum("+
            SocialCalc.crToCoord(col,row)+":"+SocialCalc.crToCoord(col, editor.ecell.row-1)+")";
         }
      }

   editor.EditorAddToInput(cmd, "=");

  }

</script>
</body>
</html>
